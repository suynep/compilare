package api

import (
	"io"
	"log"
	"net/http"
	"net/url"

	"os"
	"path/filepath"
)

const (
	AEON_BASE      = "https://aeon.co"
	AEON_ROUTE_RSS = "/feed.rss"
)

var RSS_FILE_PATH = filepath.Join(".", "aeon_feed.rss") // will be hard-coded for the time being

func FetchRSSFile() {
	url, err := url.JoinPath(AEON_BASE, AEON_ROUTE_RSS)

	if err != nil {
		log.Fatalf("Error Occurred while fetching RSS Feed: %v", err)
	}

	resp, err := http.Get(url)

	if err != nil {
		log.Fatalf("Error Occurred while fetching via GET: %v", err)
	}

	defer resp.Body.Close()

	outPath, err := os.Create(RSS_FILE_PATH)

	if err != nil {
		log.Fatalf("Error Occurred while reading the response body: %v", err)
	}

	defer outPath.Close()

	_, err = io.Copy(outPath, resp.Body)

	if err != nil {
		log.Fatalf("Error Occurred while writing the response body: %v", err)
	}
}
